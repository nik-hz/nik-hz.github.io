name: Update publications from Google Scholar

on:
  schedule:
    - cron: '0 3 * * 0'   # Every Sunday at 03:00 UTC
  workflow_dispatch:

permissions:
  contents: write


jobs:
  update-bib:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          pip install scholarly bibtexparser

      - name: Fetch publications from Google Scholar
        run: |
          python3 - <<'EOF'
          from scholarly import scholarly
          scholar_id = "cDAETuUAAAAJ"  # â† your Google Scholar ID
          author = scholarly.search_author_id(scholar_id)
          author = scholarly.fill(author, sections=['publications'])
          entries = []
          for pub in author['publications']:
              pub = scholarly.fill(pub)
              try:
                  bib = scholarly.bibtex(pub)
                  entries.append(bib)
              except Exception as e:
                  print("Skipping:", pub.get('bib', {}).get('title'), e)
          with open('_bibliographies/publications.bib', 'w') as f:
              f.write('\n\n'.join(entries))
          EOF

      - name: Commit and push if changed
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add _bibliographies/publications.bib
          git commit -m "Auto-update publications from Google Scholar" || echo "No changes"
          git push
